parameters:
- name: 'platforms'
  type: object
  default:
  - name: vs
    preStep: 'echo prestep'
    targets: 'target/sonic-vs.bin'
    buildOptions:
    script: ''
    postStep: ''
jobs:
- ${{ each platform in parameters.platforms }}:
  - job: ${{ format('Publish_mirror_{0}', platform.name) }}
    timeoutInMinutes: 0
    variables:
      PLATFORM: ${{ platform.name }}
      BUILD_OPTIONS: ${{ platform.buildOptions }}
    steps:
    - ${{ if ne(platform.preStep, '') }}:
      - bash: |
          ${{ platform.preStep }}
        displayName: 'PreStep'
    - script: |
        make PLATFORM=$PLATFORM configure
      displayName: 'Make configure'
    - ${{ if ne(platform.targets, '') }}:
      - bash: |
          ${{ platform.prestep }}
        displayName: 'Buildstep'
    - ${{ if ne(platform.script, '') }}:
      - bash: |
          ${{ platform.script }}
        displayName: 'BuildScript'
    - ${{ if ne(platform.postStep, '') }}:
      - bash: |
          ${{ platform.poststep }}
        displayName: 'PostStep'
